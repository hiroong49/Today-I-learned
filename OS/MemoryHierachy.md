# 메모리 계층 구조 (Memory Hierachy)
= 기억장치 계층
- 메모리를 필요에 따라 여러가지 종류로 나누어 놓는 것 

  -> CPU가 메모리에 더 빨리 접근할 수 있다
- 컴퓨터의 설계에 있어 각각의 특징이 있는 서로 다른 여러 종류의 저장 장치를 함께 사용하여 최적의 효율을 낼 수 있게 한다.
- 상황에 맞게 여러 저장 장치를 각각 사용할 수 있도록 저렴하고 성능 좋은 컴퓨터를 구현하는 설계이다.  
<br>

![](https://velog.velcdn.com/images/jimeaning/post/15310acd-70b2-43e1-b0f0-78cc6066f448/image.png)

| 명칭 | 위치 | 접근 속도
| --- | --- | --- |
| 레지스터 | CPU 내부 | 빠름 |
| 캐시 | CPU 내부 | 빠름
| 메모리 | CPU 외부 | 레지스터와 캐시보다 느림
|하드디스크| CPU 직접 접근 불가 | 데이터를 메모리로 이동시켜 접근 가능  
<br>

### 레지스터 (Register)
**CPU 내에서 데이터를 기억하는 메모리 장치**  
CPU가 요청을 처리하는데 필요한 데이터를 일시적으로 저장하는 기억장치  
프로세서에 위치한 고속 메모리로, 프로세스가 바로 사용할 수 있는 데이터(소량의 데이터, 처리 중인 중간 결과 등)를 담고 있는 영역  
메모리 장치 중 속도가 가장 빠르다
- CPU(Central Processing Unit), 중앙처리장치
  - 컴퓨터에서 4대 주요 기능(기억, 해석, 연산, 제어)을 관할하는 장치
  - CPU는 자체적으로 데이터를 저장할 방법이 없으므로 메모리로 직접 데이터를 전송할 수 없음
-> 연산을 위해서 반드시 레지스터를 거쳐야 하고, 이를 위해 레지스터는 특정 주소를 가리키거나 값을 읽어올 수 있음  

![](https://velog.velcdn.com/images/jimeaning/post/3803e226-4115-4a07-ac29-355e61045d11/image.png)

- CPU 내부 레지스터 종류

| 종류 | 설명 |
| --- | --- |
프로그램 계수기(PC, Program Counter) | 다음에 실행할 명령어(instruction) 주소를 가지고 있는 레지스터 |
누산기(AC, ACcumulator) | 연산 결과 데이터를 일시적으로 저장하는 레지스터 |
명령어 레지스터(IR, Instruction Register) | 현재 수행 중인 명령어를 가지고 있는 레지스터 |
상태 레지스터(SR, Status Register) | 현재 CPU의 상태를 가지고 있는 레지스터
메모리 주소 레지스터(MAR, Memory Address Register) | 메모리부터 읽어오거나 메모리에 쓰기 위한 주소를 가지고 있는 레지스터
메모리 버퍼 레지스터(MBR, Memory Buffer Register) | 메모리부터 읽어 온 데이터나 메모리에 써야 할 데이터를 가지고 있는 레지스터
입출력 주소 레지스터(I/O AR, I/O Address Register) | 입출력 장치에 따른 입출력 모듈의 주소를 가지고 있는 레지스터
입출력 버퍼 레지스터(I/O BR, I/O Buffer Register) | 입출력 모듈과 프로세서 간의 데이터 교환을 위해 사용되는 레지스터

<br>

### 캐시(Cache)
- 데이터나 값을 미리 복사해 놓는 임시 장소 (**사용되었던 데이터는 다시 사용되어질 가능성이 높다는 개념**을 이용)
- 시스템의 효율성을 위해 사용
  - 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 더 긴 경우
  - 값을 다시 계산하는 시간을 절약하고 싶은 경우
- 속도가 빠른 장치(중앙처리장치)와 느린 장치(주기억장치) 사이에서 속도차에 따른 병목 현상을 완화하기 위한 범용 메모리
- CPU에 레지스터와 메인메모리 사이에 위치

![](https://velog.velcdn.com/images/jimeaning/post/6c460397-7083-4344-9419-36c2f89b7412/image.png)


**캐싱**: 캐시(Cache)라고 하는 좀 더 빠른 메모리 영역으로 데이터를 가져와서 접근하는 방식  
<br/>

#### 캐시의 종류
- CPU 캐시
  - 대용량의 메인 메모리 접근을 빠르게 하기 위해 CPU 칩 내부나 바로 옆에 탑재하는 작은 메모리
  - 하드웨어를 통해 관리  
  
  | 종류 | 설명 | CPU 성능에 직접적 영향 |
  | --- | --- | --- |
  | L1 캐시	| 일반적으로 CPU 칩 안에 내장되어 데이터 사용 및 참조에 가장 먼저 사용되는 캐시 메모리	| O
  L2 캐시 | - L1 캐시 메모리와 용도와 역할이 비슷 <br> - 속도 : L1 캐시 > L2 캐시 > 일반메모리(RAM) | O
  L3 캐시 | - L1 캐시, L2 캐시와 동일한 원리로 작동<br>- 대부분 CPU가 아닌 메인보드에 내장 | X

- 디스크 캐시(=디스크 버퍼)
  하드디스크에 내장된 '작은 컴퓨터'(기능: 디스크 제어, 외부와의 인터페이스)가 소유한 '작은 메모리'(디스크에 입출력되는 데이터를 저장하는 작은 메모리) => 일종의 기법(하드디스크와 RAM 사이에 존재)

- 기타
  - 소프트웨어적으로 관리
  - 페이지 캐시: 운영체제의 메인 메모리를 하드디스크에 복사해놓는 캐시 ex) 웹브라우저의 웹 페이지 캐시  

<br/>

#### 캐시의 지역성
- 데이터 접근이 시간적, 혹은 공간적으로 가깝게 일어나는 것
- 캐시가 효율적으로 동작하기 위해서는 캐시가 저장할 데이터가 지역성을 가져야 함
  
| 종류 | 설명 |
| --- | --- |
시간적 지역성 | 특정 데이터가 한번 접근되었을 경우, 가까운 미래에 또 한번 데이터에 접근할 가능성이 높음
공간적 지역성 | 액세스된 기억장소와 인접한 기억장소가 액세스될 확률이 높음

<br>

#### 캐시를 언제 사용하면 좋을까?
1. 단순한 데이터(정보)
2. 동일한 데이터를 반복적으로 제공해야 할 때
3. 데이터의 변경주기가 빈번하지 않고, 단위 처리 시간이 오래 걸리는 경우
4. 데이터의 최신화가 반드시 실시간으로 이뤄지지 않아도 서비스 품질에 영향을 거의 주지 않는 데이터

이렇게 캐시를 사용하면 서버 간 불필요한 트래픽을 줄일 수 있고, 그로 인해 웹 어플리케이션 서버의 부하가 감소됨. 또한 캐시에 저장된 데이터를 빠르게 읽어와 어플리케이션을 사용하는 고객에게 쾌적한 서비스 경험을 제공할 수 있음.

<br>

### 메인 메모리(Main Memory)
- 주기억장치(= 1차 기억장치)
- 컴퓨터에서 수치, 명령, 자료 등을 기억하는 컴퓨터 하드웨어 장치

#### 구성
- RAM(Random Access Memory): 휘발성 기억 장치
  - 컴퓨터가 빠른 액세스를 하기 위해 데이터를 단기간 저장하는 구성 요소
  - 사용자가 요청하는 프로그램이나 문서를 스토리지 디스크에서 메모리로 로드하여 각각의 정보에 액세스
  - 전원이 유지되는 동안 CPU의 연산 및 동작에 필요한 모든 내용이 저장
  - 전원 종료 시 기억된 내용 삭제
  - Random Access : 어느 위치에서든 똑같은 속도로 접근하여 읽고 쓸 수 있다는 의미
  - HDD에 비해 월등히 빠른 속도를 가짐
  - RAM은 DRAM과 SRAM이 있는데 주기억장치는 주로 DRAM을 의미함 (SRAM은 캐시나 레지스터)
  >**DRAM과 SRAM**  
  >  - **DRAM (Dynamic RAM)**
  >     - 동적 메모리
  >     - 전원이 계속 공급되더라도 주기적으로 재충전되어야 기억된 내용을 유지할 수 있다
  >     - 주로 대용량의 기억장치에 사용되며 가격이 저렴하다
  >     - 주로 RAM이라고 표현하는 것(주기억장치)은 거의 DRAM을 지칭한다 <br>
  >  - **SRAM(Static RAM)**
  >     - 정적 메모리
  >     - 전원 공급이 되는 동안은 기록된 내용이 지워지지 않기 때문에 재충전이 필요 없다
  >     - 접근 속도가 빠르고 가격이 비싸다는 특징이 있으며 주로 캐시메모리나 레지스터로 사용된다
- ROM(Read Only Memory): 고정 기억 장치
  - 컴퓨터에 지시사항을 영구히 저장하는 비휘발성 메모리
  - 전원 종료시 기억된 내용 유지
  - 변경 가능성이 희박한 기능 및 부품에 사용
    - 소프트웨어: 초기 부팅 관련 부분
    - 하드웨어: 프린터 작동에 관여하는 펌웨어 명령 등

<br>

### 스토리지(SSD, HDD)
- 프로그램이 구동될 때에는 직접 쓰이지 않는 '보조 기억장치' 또는 '저장소'들 중에서는 컴퓨터 안에 내장되어 있는 이 메모리들이 대개 최상위에 위치함  
- 둘 다 있는 컴퓨터에서는 대개 SSD가 HDD보다 상위에 위치
- SSD는 데이터를 읽고 쓰는 속력이 매우 빠르지만 1GB당 가격이 비싸다
- HDD는 반대로 속력이 느리지만 1GB당 가격이 싸다

<br>

### 하드디스크 드라이브(Hard Disk Drive, HDD)
- 하드 디스크, 하드 드라이브, 고정 디스크
- 비휘발성, 순차접근이 가능한 컴퓨터의 보조 기억 장치
- 비휘발성 데이터 저장소 가운데 가장 대중적이고 용량 대비 가격이 가장 저렴

#### 작동 원리
- 보호 케이스 내부의 플래터를 회전 -> 플래터에 자기 패턴으로 정보 기록
- 플래터 표면의 코팅된 자성체에 데이터 기록
- 회전하는 플래터 위에 부상하는 입출력 헤드에 의해 자기적으로 데이터 기록 및 조회 가능

#### 구성 요소
- 제어회로
  - 하드디스크의 총괄적인 부분을 제어하는 회로
  - 제어회로 내부의 버퍼 메모리는 하드 디스크에 입출력될 데이터를 임시 저장함
- 스핀들 모터(Spindle Motor)
  - 플래터의 회전을 담당하는 부분
- 플래터(Platter)
  - 데이터 기록 담당
  - 하나의 하드디스크에 한 개 이상 장착
  - 플래터 수가 많아질 수록 용량 저장 크기는 커지고 안정성은 줄어든다
- 액추에이터(Actuator)
  - 제어회로의 명령에 따라 액추에이터 암 구동 -> 헤드가 원하는 데이터 조회 가능
- 액추에이터 암(Actuator Arm)
   - 액추에이터를 통해 구동됨
   - 하나의 디스크에 여러 개 달려 있음
   - 암의 끝 부분에 입출력을 위한 헤드 달려 있음
- 헤드(Head)
  - 데이터를 읽고 쓰는 헤드

<br>

### 이동식 저장장치
- USB메모리, ODD 등을 의미한다
- 기업용으로는 자기테이프도 있다
- 키보드, 마우스 등 입력장치나 클라우드 스토리지 등을 이 위치에 넣기도 한다

<br>

### 메모리 계층 구조의 필요성
CPU는 작은 메모리에 더 빨리 접근 가능하다

#### 디코딩(명령어 해독 단계) 속도
- 디코딩(Decoding): 복호화라고도 하며, 부호화(Encoding)된 정보를 부호(code)화되기 전으로 되돌리는 처리 혹은 그 처리 방식
- CPU는 3개의 버스를 통해 메모리에 접근함
  - 주소 전달 버스: CPU가 메모리의 어느 부분의 데이터를 접근할지 나타냄
  - 데이터 전달 버스: 메모리와 CPU 간 데이터 전송
  - 컨트롤 신호 버스: CPU의 메모리 접근 여부 표시
- 주소 전달 버스 및 데이터 전달 버스에 값이 존재하고 컨트롤 신호를 전송 -> CPU와 메모리 업무 수행
- 큰 메모리 용량을 사용할 경우 디코딩하는데 더 많은 시간이 소요됨  
  -> **CPU가 빠르게 데이터에 접근하기 위해서는 데이터를 저장하는 메모리가 작아야 한다**

  <br>

#### 자주 쓰는 데이터는 계속 자주 쓰임(참조의 지역성)
- 큰 메모리를 사용한다고 해도 그 안에 모든 데이터를 고르게 접근하지 않음
- **자주 쓰이는 데이터는 계속 자주 쓰이고, 자주 쓰이지 않는 데이터는 계속 자주 쓰이지 않음**  
  => 운영체제, CPU -> 자동으로 자주 쓰이거나 쓰일 것 같은 데이터를 메모리에서 캐시로 읽어옴
- 자주 쓰이는 데이터는 전체 데이터 양에 비해 작은 양이므로 캐시는 메모리보다, 메모리는 하드디스크보다 더 작아도 된다

<br>

#### 경제성
- 메모리 구조에서 상층에 속할수록 더 비싸다
- 메모리 계층 구조의 모양이 피라미드인 이유
  - 비싼 하드웨어는 꼭 필요한 크기만큼만 사용
  - 싼 하드웨어를 넉넉한 크기만큼 사용

<br>

#### 참고
[메모리 계층 구조-velog](https://velog.io/@yu-jin-song/CS-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B3%84%EC%B8%B5-%EA%B5%AC%EC%A1%B0)  
[메모리 계층 구조-나무위키](https://namu.wiki/w/%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EA%B3%84%EC%B8%B5%20%EA%B5%AC%EC%A1%B0)  
[메모리 계층구조-velog](https://velog.io/@steadygo247/%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B3%84%EC%B8%B5%EA%B5%AC%EC%A1%B0)