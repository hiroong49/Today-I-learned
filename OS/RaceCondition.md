# Race Condition (경쟁 상태)

경쟁 상태(Race Condition)은 두 개 이상의 프로세스가 공통 자원을 병행적으로 읽거나 쓸 때, 공용 데이터에 대한 접근이 순서에 따라 실행 결과가 달라지는 상황이다.

Race Condition이 발생하게 되면, 모든 프로세스에 원하는 결과가 발생하는 것을 보장할 수 없다. 따라서 이러한 상황은 피해야 하며 상호배제나 임계구역으로 해결이 가능하다.

<br>

### Critical Section(임계 영역)
통장에 돈이 100만원 있다. 지난 달 친구에게 빌렸던 50만원을 갚으려고 이체를 하고 있었다. 계좌번호와 금액을 입력하고 송금 버튼을 눌렀다. 그런데, 오늘 마침 카드값 70만원이 빠져나가는 날이다. 정말 정말 우연히 저의 이체와 카드값 이체가 동시에 일어났다. 그런데 두 이체가 통장에 있는 잔액을 확인했을 때 100만원으로 이체들이 모두 성공해 버렸다. 은행에 비상이 걸렸다! 이런 일이 계속 반복된다면 은행은 곧 파산할 수 있다.  

이렇게 통장에 동시에 접근하게 되면 곤란한 문제가 생긴다. 통장에 아무나 접근하지 못하도록 보호되어야 하는 부분을 Critical Section(임계 영역)이라고 한다.

Critical Section에 접근하려면 각 프로세스의 code segment에 공유 데이터에 접근하는 코드를 사용한다.

<br>

### Race Condition 해결을 위한 충족 조건 3가지

- **Mutual Exclusion (상호 배제)**  
  어떤 프로세스가 임계 영역을 수행 중이면 다른 모든 프로세스들은 그 임계 영역에 들어가지 못하게 막는 것이다. [뮤텍스, 세마포어](https://github.com/hiroong49/Today-I-learned/blob/main/OS/MutexSemaphore.md)가 있다.

- **Progress(진행)**  
  임계 영역에 들어 간 프로세스가 없는 상태에서 임계 영역에 들어가려는 프로세스가 있으면 들어가게 해주어야 한다. 즉, 임계영역에 있는 프로세스 외에는 다른 프로세스가 임계 영역에 진입하는 것을 방해하면 안 된다.

- **Bounded Waiting(한정 대기)**  
기아(starvation) 상태를 방지하기 위해 프로세스가 임계 영역에 들어가려고 요청한 후부터 다른 프로세스들이 임계 영역에 들어가는 횟수에 한계가 있어야 한다. 임계 영역에 한 번 들어갔다 나온 프로세스는 다음에 들어갈 떄 제한을 준다.


<br>

#### 참고
[경쟁상태란? -티스토리](https://zangzangs.tistory.com/115)  
[Race Condition이란?](https://gyoogle.dev/blog/interview/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C.html#race-condition%E1%84%8B%E1%85%B5%E1%84%85%E1%85%A1%E1%86%AB)